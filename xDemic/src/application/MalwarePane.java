package application;

import javafx.scene.control.Button;
import javafx.scene.control.ScrollPane;
import javafx.scene.control.Slider;
import javafx.scene.control.TextField;
import javafx.scene.layout.VBox;
import javafx.scene.text.Text;

public class MalwarePane extends ScrollPane {
	private MainView mainView;
	
	private VBox malwareList;
	
	public MalwarePane(MainView mainView) {
		this.mainView = mainView;
		
		setMinWidth(200);
		setMinHeight(400);
		
		malwareList = new VBox();
		
		setContent(malwareList);
	}
	
	public void update() {
		setPrefWidth(mainView.getWidth()/5);
		setPrefHeight(mainView.getHeight()*2/3-mainView.getTools().getHeight());
		
		malwareList.getChildren().clear();
		
		if(!mainView.getSimulation().getMalwareList().isEmpty()) {
			for(int i=0; i<mainView.getSimulation().getMalwareList().size(); i++) {
				VBox malware = new VBox();
				malware.getStyleClass().add("malware");
				
				int id = i;
				
				Text name = new Text("Name: " + mainView.getSimulation().getMalwareList().get(i).getName());
				Text infect = new Text("Chance of Infection: " + String.format("%.2f", mainView.getSimulation().getMalwareList().get(i).getChanceInfection()) + "%");
				Text patch = new Text("Patch Release: " + mainView.getSimulation().getMalwareList().get(i).getPatchRelease());
				Button remove = new Button("Remove");
				remove.setOnAction((e) -> {
					// remove malware from all devices
					for(int j=0; j<mainView.getSimulation().getDeviceList().size(); j++) {
						if(mainView.getSimulation().getDeviceList().get(j).getMalwareList().contains(mainView.getSimulation().getMalwareList().get(id))) {
							mainView.getSimulation().getDeviceList().get(j).getMalwareList().remove(mainView.getSimulation().getMalwareList().get(id));
						}
					}
					// remove malware from malwareList
					mainView.getSimulation().getMalwareList().remove(id);
					mainView.draw();
				});
				malware.getChildren().addAll(name, infect, patch, remove);
				
				malwareList.getChildren().add(malware);
			}
		}
	}
	
	public void add() {
		if(mainView.editing()) {		
			VBox options = new VBox();
			options.getStyleClass().add("options");
			
			Text nameLabel = new Text("Name");
			TextField name = new TextField();
			
			Text chanceInfectionLabel = new Text("Chance of Infection");
			Slider chanceInfection = new Slider(0, 100, 10);
			chanceInfection.setShowTickLabels(true);
			chanceInfection.setShowTickMarks(true);
			
			Text patchReleaseLabel = new Text("Patch Release");
			Slider patchRelease = new Slider(0, 100, 10);
			patchRelease.setShowTickLabels(true);
			patchRelease.setShowTickMarks(true);
			patchRelease.setSnapToTicks(true);
			
			Button apply = new Button("Apply");
			apply.setOnAction((e) -> {
				if((name.getText() != null && !name.getText().isEmpty())) {
					mainView.getSimulation().getMalwareList().add(new Malware(name.getText(), chanceInfection.getValue(), (int)patchRelease.getValue()));
		        } else {
		        	mainView.getSimulation().getMalwareList().add(new Malware("Default", chanceInfection.getValue(), (int)patchRelease.getValue()));
		        }
				mainView.setCenter(mainView.getOutput());
				mainView.draw();
			});
		
			Button cancel = new Button("Cancel");
			cancel.setOnAction((e) -> {
				mainView.setCenter(mainView.getOutput());
				mainView.draw();
			});
			
			options.getChildren().addAll(nameLabel, name, chanceInfectionLabel, chanceInfection, patchReleaseLabel, patchRelease, apply, cancel);
			mainView.setCenter(options);
		}
	}
}